#!/bin/bash
# PostgreSQLInstall - Installs PostgreSQL and creates a basic user and database

set -e

echo "🐘 Installing PostgreSQL on Raspberry Pi..."

# Update package list
sudo apt update

# Install PostgreSQL and contrib tools
sudo apt install -y postgresql postgresql-contrib

# Enable and start the PostgreSQL service
sudo systemctl enable postgresql
sudo systemctl start postgresql

# Setup default user and database
# You can change these defaults below
PG_USER="piuser"
PG_DB="pidata"
PG_PASSWORD="raspberry"

echo "🔐 Creating PostgreSQL user '$PG_USER' and database '$PG_DB'..."

sudo -u postgres psql <<EOF
CREATE USER $PG_USER WITH PASSWORD '$PG_PASSWORD';
CREATE DATABASE $PG_DB OWNER $PG_USER;
ALTER USER $PG_USER WITH SUPERUSER;
EOF

echo "✅ PostgreSQL installation complete."
echo "📦 User: $PG_USER"
echo "📂 Database: $PG_DB"
echo "➡ Connect via: psql -U $PG_USER -d $PG_DB"
