#!/bin/bash

# ==============================================================================
# SCRIPT: gitBackup
# PURPOSE: Create a timestamped archive of all scripts and Grafana config
#          - Stores archive in /mnt/ssd/backups
#          - Optionally commits & pushes to GitHub
# ==============================================================================

set -e

REPO_DIR="/mnt/ssd/RPi5"
SCRIPT_DIR="$REPO_DIR/scripts"
GRAFANA_CONF_DIR="/mnt/ssd/grafana-config"
BACKUP_DIR="/mnt/ssd/backups"
DATE_TAG=$(date +%Y-%m-%d-%H%M%S)
BACKUP_FILE="$BACKUP_DIR/backup-$DATE_TAG.tar.gz"

echo "üì¶ Creating backup archive at: $BACKUP_FILE"
mkdir -p "$BACKUP_DIR"

tar -czf "$BACKUP_FILE" \
  -C "$REPO_DIR" scripts \
  -C /mnt/ssd grafana-config

echo "‚úÖ Backup complete."

read -rp "üì§ Commit & push latest changes to GitHub? [y/N]: " confirm_push
if [[ "$confirm_push" =~ ^[Yy]$ ]]; then
  cd "$REPO_DIR"
  git add .
  git commit -m "Backup on $DATE_TAG"
  git push
  echo "üöÄ Git push complete."
else
  echo "‚è≠Ô∏è  Skipping Git push."
fi
