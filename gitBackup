#!/bin/bash

# ==============================================================================
# SCRIPT: gitRestore
# PURPOSE: Restore SSH keys, Git config, and .bashrc from the latest Git-tracked backup
# USAGE: Run ON THE PI after reimaging and cloning your Git repo into ~/scr
# ==============================================================================

set -e

BACKUP_ROOT=~/scr/backups
LATEST_BACKUP=$(ls -dt "$BACKUP_ROOT"/git_ssh_backup_* 2>/dev/null | head -n 1)

if [ -z "$LATEST_BACKUP" ] || [ ! -d "$LATEST_BACKUP" ]; then
  echo "❌ No backup found in $BACKUP_ROOT"
  exit 1
fi

echo "Restoring from: $LATEST_BACKUP"

echo "Restoring SSH keys..."
cp -r "$LATEST_BACKUP/.ssh" ~/
chmod 700 ~/.ssh
chmod 600 ~/.ssh/id_rsa 2>/dev/null || true
chmod 644 ~/.ssh/id_rsa.pub 2>/dev/null || true

echo "Restoring Git config..."
cp "$LATEST_BACKUP/.gitconfig" ~/ 2>/dev/null || echo "⚠️ .gitconfig not found in backup"

echo "Restoring .bashrc..."
cp "$LATEST_BACKUP/.bashrc" ~/ 2>/dev/null || echo "⚠️ .bashrc not found in backup"

echo "✅ Restore complete. You may want to run: source ~/.bashrc"
