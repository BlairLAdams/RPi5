#!/bin/bash

# ==============================================================================
# SCRIPT: gitBackup
# PURPOSE: Backup SSH keys, Git config, and .bashrc into ~/scr/backups/git_ssh_backup_<timestamp>
#          Commit all contents to GitHub for full Git-based recovery
# USAGE: Run ON THE PI before reimaging
# ==============================================================================

set -e

TIMESTAMP=$(date +%Y%m%d_%H%M)
DEST_DIR=~/scr/backups/git_ssh_backup_$TIMESTAMP
mkdir -p "$DEST_DIR"

echo "Backing up SSH keys..."
cp -r ~/.ssh "$DEST_DIR/" 2>/dev/null || echo "No SSH keys found."

echo "Backing up Git config..."
cp ~/.gitconfig "$DEST_DIR/" 2>/dev/null || echo "No .gitconfig found."

echo "Backing up .bashrc..."
cp ~/.bashrc "$DEST_DIR/" 2>/dev/null || echo "No .bashrc found."

echo "Committing backup to Git..."
cd ~/scr
git add .
git commit -m "Backup Git/SSH config - $TIMESTAMP"
git push

echo "âœ… Backup complete. Stored in ~/scr/backups/git_ssh_backup_$TIMESTAMP"